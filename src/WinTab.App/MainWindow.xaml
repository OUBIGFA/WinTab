<Window x:Class="WinTab.App.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="{DynamicResource WindowTitle_Settings}" Height="700" Width="980" 
        WindowStartupLocation="CenterScreen" FlowDirection="LeftToRight">
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <StackPanel Grid.Row="0" Margin="0,0,0,12">
            <TextBlock Text="{DynamicResource MainHeader_Title}" FontSize="24" FontWeight="SemiBold" />
            <TextBlock Text="{DynamicResource MainHeader_Subtitle}"
                       Foreground="Gray" Margin="0,4,0,0" />
        </StackPanel>

        <StackPanel Grid.Row="1">
            <GroupBox Header="{DynamicResource GroupHeader_Startup}" Margin="0,0,0,8">
                <StackPanel Margin="8">
                    <CheckBox Content="{DynamicResource Option_RunAtStartup}"
                              IsChecked="{Binding Settings.RunAtStartup, Mode=TwoWay}" />
                    <CheckBox Content="{DynamicResource Option_StartMinimized}"
                              IsChecked="{Binding Settings.StartMinimized, Mode=TwoWay}"
                              Margin="0,4,0,0" />
                </StackPanel>
            </GroupBox>

            <GroupBox Header="{DynamicResource GroupHeader_TrayIcon}" Margin="0,0,0,8">
                <StackPanel Margin="8">
                    <CheckBox Content="{DynamicResource Option_ShowTrayIcon}"
                              IsChecked="{Binding Settings.EnableTrayIcon, Mode=TwoWay}" />
                </StackPanel>
            </GroupBox>

            <GroupBox Header="{DynamicResource GroupHeader_AutoGrouping}" Margin="0,0,0,8">
                <StackPanel Margin="8">
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <Button Content="{DynamicResource Button_AddRule}" Width="90" Click="OnAddRuleClicked" />
                        <Button Content="{DynamicResource Button_RemoveRule}" Width="110" Margin="8,0,0,0"
                                Click="OnRemoveRuleClicked" IsEnabled="{Binding HasSelectedRule}" />
                        <Button Content="{DynamicResource Button_ApplyRules}" Width="100" Margin="8,0,0,0"
                                Click="OnApplyRulesClicked" />
                        <TextBlock Text="{Binding AutoRuleCount, StringFormat={DynamicResource Label_RulesCount}}"
                                   Margin="12,0,0,0" VerticalAlignment="Center" />
                    </StackPanel>

                    <CheckBox Content="{DynamicResource Option_AutoApplyRules}"
                              IsChecked="{Binding Settings.AutoApplyRules, Mode=TwoWay}"
                              Checked="OnAutoApplyToggled"
                              Unchecked="OnAutoApplyToggled"
                              Margin="0,0,0,6" />

                    <DataGrid ItemsSource="{Binding AutoGroupRules}"
                              SelectedItem="{Binding SelectedRule, Mode=TwoWay}"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              IsReadOnly="False"
                              HeadersVisibility="Column"
                              MinHeight="140">
                        <DataGrid.Columns>
                        <DataGridCheckBoxColumn Header="{DynamicResource DataGridHeader_Enabled}" Binding="{Binding Enabled, Mode=TwoWay}" Width="Auto" />
                        <DataGridComboBoxColumn Header="{DynamicResource DataGridHeader_MatchType}"
                                                SelectedItemBinding="{Binding MatchType, Mode=TwoWay}"
                                                ItemsSource="{Binding DataContext.MatchTypes, RelativeSource={RelativeSource AncestorType=Window}}"
                                                Width="Auto" />
                        <DataGridTextColumn Header="{DynamicResource DataGridHeader_GroupName}"
                                            Binding="{Binding GroupName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                            Width="*" />
                        <DataGridTextColumn Header="{DynamicResource DataGridHeader_Priority}"
                                            Binding="{Binding Priority, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                            Width="Auto" />
                        <DataGridTextColumn Header="{DynamicResource DataGridHeader_MatchValue}"
                                            Binding="{Binding MatchValue, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                            Width="*" />
                        </DataGrid.Columns>
                    </DataGrid>
                    <TextBlock Text="{DynamicResource HelpText_MatchTypes}"
                               Foreground="Gray" Margin="0,6,0,0" />
                </StackPanel>
            </GroupBox>

            <GroupBox Header="{DynamicResource GroupHeader_Groups}" Margin="0,0,0,8">
                <StackPanel Margin="8">
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <Button Content="{DynamicResource Button_RefreshList}" Width="100" Click="OnRefreshGroupsClicked" />
                        <Button Content="{DynamicResource Button_OpenAll}" Width="100" Margin="8,0,0,0"
                                Click="OnOpenAllGroupsClicked" />
                        <Button Content="{DynamicResource Button_CloseAll}" Width="100" Margin="8,0,0,0"
                                Click="OnCloseAllGroupsClicked" />
                        <Button Content="{DynamicResource Button_OpenGroup}" Width="100" Margin="8,0,0,0"
                                Click="OnOpenGroupClicked" IsEnabled="{Binding HasSelectedGroup}" />
                        <Button Content="{DynamicResource Button_CloseGroup}" Width="100" Margin="8,0,0,0"
                                Click="OnCloseGroupClicked" IsEnabled="{Binding HasSelectedGroup}" />
                        <TextBlock Text="{Binding GroupCount, StringFormat={DynamicResource Label_GroupsCount}}"
                                   Margin="12,0,0,0" VerticalAlignment="Center" />
                    </StackPanel>

                    <CheckBox Content="{DynamicResource Option_AutoOpenGroups}"
                              IsChecked="{Binding Settings.AutoOpenGroups, Mode=TwoWay}"
                              Checked="OnAutoOpenGroupsToggled"
                              Unchecked="OnAutoOpenGroupsToggled"
                              Margin="0,0,0,8" />

                    <CheckBox Content="{DynamicResource Option_AutoCloseEmptyGroups}"
                              IsChecked="{Binding Settings.AutoCloseEmptyGroups, Mode=TwoWay}"
                              Margin="0,0,0,8" />

                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <TextBlock Text="{DynamicResource Label_RenameTo}" VerticalAlignment="Center" />
                        <TextBox Width="180" Margin="8,0,0,0"
                                 Text="{Binding GroupRenameText, UpdateSourceTrigger=PropertyChanged}" />
                        <Button Content="{DynamicResource Button_RenameGroup}" Width="110" Margin="8,0,0,0"
                                Click="OnRenameGroupClicked" IsEnabled="{Binding CanRenameGroup}" />
                    </StackPanel>

                    <DataGrid ItemsSource="{Binding GroupEntries}"
                              SelectedItem="{Binding SelectedGroup, Mode=TwoWay}"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              IsReadOnly="True"
                              HeadersVisibility="Column"
                              MinHeight="120">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="{DynamicResource DataGridHeader_GroupName_Column}" Binding="{Binding Name}" Width="*" />
                            <DataGridCheckBoxColumn Header="{DynamicResource DataGridHeader_Open}" Binding="{Binding IsOpen}" Width="Auto" />
                            <DataGridTextColumn Header="{DynamicResource DataGridHeader_Windows}" Binding="{Binding WindowCount}" Width="Auto" />
                        </DataGrid.Columns>
                    </DataGrid>
                </StackPanel>
            </GroupBox>

            <GroupBox Header="{DynamicResource GroupHeader_WindowInspector}" Margin="0,0,0,8">
                <StackPanel Margin="8">
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <Button Content="{DynamicResource Button_Refresh}" Width="90" Click="OnRefreshClicked" />
                        <CheckBox Content="{DynamicResource Option_IncludeInvisible}" Margin="12,0,0,0"
                                  IsChecked="{Binding IncludeInvisible, Mode=TwoWay}" />
                        <TextBlock Text="{Binding WindowCount, StringFormat={DynamicResource Label_FoundWindows}}"
                                   Margin="12,0,0,0" VerticalAlignment="Center" />
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <Button Content="{DynamicResource Button_BringToFront}" Width="120" Click="OnBringToFrontClicked"
                                IsEnabled="{Binding HasSelection}" />
                        <Button Content="{DynamicResource Button_Minimize}" Width="90" Margin="8,0,0,0"
                                Click="OnMinimizeClicked" IsEnabled="{Binding HasSelection}" />
                        <Button Content="{DynamicResource Button_Restore}" Width="90" Margin="8,0,0,0"
                                Click="OnRestoreClicked" IsEnabled="{Binding HasSelection}" />
                        <Button Content="{DynamicResource Button_Close}" Width="90" Margin="8,0,0,0"
                                Click="OnCloseWindowClicked" IsEnabled="{Binding HasSelection}" />
                        <Button Content="{DynamicResource Button_SetTarget}" Width="100" Margin="8,0,0,0"
                                Click="OnSetTargetClicked" IsEnabled="{Binding HasSelection}" />
                        <Button Content="{DynamicResource Button_ClearTarget}" Width="110" Margin="8,0,0,0"
                                Click="OnClearTargetClicked" IsEnabled="{Binding HasTarget}" />
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <TextBlock Text="{DynamicResource Label_TargetWindow}" FontWeight="SemiBold" />
                        <TextBlock Text="{Binding TargetWindowLabel}" Margin="8,0,0,0" />
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <Button Content="{DynamicResource Button_AttachToHost}" Width="120" Click="OnAttachClicked"
                                IsEnabled="{Binding HasSelection}" />
                        <Button Content="{DynamicResource Button_DetachFromHost}" Width="140" Margin="8,0,0,0"
                                Click="OnDetachClicked" IsEnabled="{Binding HasAttachedInHost}" />
                        <TextBlock Text="{Binding HostStatus}" Margin="12,0,0,0" VerticalAlignment="Center" />
                    </StackPanel>

                    <DataGrid ItemsSource="{Binding Windows}"
                              SelectedItem="{Binding SelectedWindow, Mode=TwoWay}"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              IsReadOnly="True"
                              HeadersVisibility="Column"
                              MinHeight="240">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="{DynamicResource DataGridHeader_Title}" Binding="{Binding Title}" Width="2*" />
                            <DataGridTextColumn Header="{DynamicResource DataGridHeader_Process}" Binding="{Binding ProcessName}" Width="*" />
                            <DataGridTextColumn Header="{DynamicResource DataGridHeader_PID}" Binding="{Binding ProcessId}" Width="Auto" />
                            <DataGridTextColumn Header="{DynamicResource DataGridHeader_Class}" Binding="{Binding ClassName}" Width="*" />
                            <DataGridTextColumn Header="{DynamicResource DataGridHeader_Handle}" Binding="{Binding HandleHex}" Width="Auto" />
                            <DataGridCheckBoxColumn Header="{DynamicResource DataGridHeader_Visible}" Binding="{Binding IsVisible}" Width="Auto" />
                        </DataGrid.Columns>
                    </DataGrid>
                </StackPanel>
            </GroupBox>

            <GroupBox Header="{DynamicResource GroupHeader_Diagnostics}">
                <StackPanel Margin="8">
                    <TextBlock Text="{DynamicResource Label_LogFileLocation}" FontWeight="SemiBold" />
                    <TextBlock Text="{Binding LogPath}" TextWrapping="Wrap" Margin="0,4,0,0" />
                </StackPanel>
            </GroupBox>
        </StackPanel>

        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right">
            <Button Content="{DynamicResource Button_Save}" Width="90" Margin="0,0,8,0" Click="OnSaveClicked" />
            <Button Content="{DynamicResource Button_Close}" Width="90" Click="OnCloseClicked" />
            <Button Content="{DynamicResource Button_SwitchLanguage}" Width="180" Margin="8,0,0,0" Click="OnSwitchLanguageClicked" />
        </StackPanel>
    </Grid>
</Window>
